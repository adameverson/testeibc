<% @title="Show Board" %>

<p id="notice"><%= notice %></p>

<div class="btn btn-outline-info btn-sm">
    <%= link_to 'Boards', boards_path, :class => "btn" %>
</div>
<div class="btn btn-outline-info btn-sm">
    <%= link_to 'Phases', phases_path, :class => "btn" %>
</div>
<div class="btn btn-outline-info btn-sm">
    <%= link_to 'Tasks', tasks_path, :class => "btn" %>
</div>

<p>
  <strong>Id board:</strong>
  <%= @board.id %>
  <h1> <%= @board.name %> </h1>
</p>

<%= link_to 'Edit', edit_board_path(@board) %> |
<%= link_to 'Destroy', @board, method: :delete, data: { confirm: 'Are you sure?' } %>

<h1>Phases</h1>

<div class="btn btn-outline-info btn-sm">
  <%= link_to 'New Phase', new_phase_path, :class => "btn" %>
</div>
<% $condition = false
ActiveRecord::Base.connection.exec_query("select * from phases where id_board=#{@board.id}").each do |i|
  $condition = true
  break
end %>
<div class="btn btn-outline-info btn-sm">
  <%= link_to_if $condition == true, 'New Task', new_task_path, :class => "btn" %>
</div>
<h1></h1>

<table class="table table-bordered">
  <tbody>

    <tr>
      <% ActiveRecord::Base.connection.exec_query("select * from phases where id_board=#{@board.id}").each do |i| %>
        <th>Id</th>
        <th colspan="3">Phase</th>
      <% end %>
    </tr>
    <tr>
      <% ActiveRecord::Base.connection.exec_query("select * from phases where id_board=#{@board.id} order by id").each do |phase| %>        
        <td><%= phase["id"] %></td>
        <td nowrap><%= phase["name"] %></td>
        <td><%= link_to 'Edit', edit_phase_path(phase["id"]) %></td>
        <td>>></td>
      <% end %> 
    </tr>
    <tr>
      <% ActiveRecord::Base.connection.exec_query("select * from phases where id_board=#{@board.id}").each do |phase| %>
        <th></th>
        <th colspan="3">Task</th>
      <%end %>
    </tr>
    <% tasks = [] 
    pha = 0 %>
    <tr>
      <% ActiveRecord::Base.connection.exec_query("select * from phases where id_board=#{@board.id}").each do |phase| i=0
        ActiveRecord::Base.connection.exec_query("select * from tasks where id_phase=#{phase["id"]} order by id").each do |task| i=1  
          if pha != task["id_phase"] %>
            <td></td>
            <td nowrap><%= task["task"] %></td>
            <td colspan="2"><%= link_to 'Edit', edit_task_path(task["id"]) %></td>
            <% pha = task["id_phase"] 
          else
            tasks.push(task)
          end
        end 
        if i == 0 %>
          <td></td>
          <td></td>
          <td colspan="2"></td>
        <% end
      end %>
    </tr>
    <% while !tasks.empty? 
      pha = 0 %>
      <tr>
        <% ActiveRecord::Base.connection.exec_query("select * from phases where id_board=#{@board.id} order by id").each do |phase| i=0
          j=0
          for task in tasks  
            if pha != task["id_phase"] && phase["id"] == task["id_phase"] %>
              <td></td>
              <td nowrap><%= task["task"] %></td>
              <td colspan="2"><%= link_to 'Edit', edit_task_path(task["id"]) %></td>
              <% pha = task["id_phase"] 
              tasks.delete_at(j)
              i=1
            end
            j = j + 1
          end 
          if i == 0 %>
            <td></td>
            <td></td>
            <td colspan="2"></td>
          <% end
        end %>
      </tr>
    <% end %>

  </tbody>
</table>

<br>
